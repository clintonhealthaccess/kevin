<table>
	<tbody>
		<!-- 
			Each INDIVIDUAL UNDERTAKINGS, this is always
			displayed because we assume there's costing for each undertaking,
			either OUTGOING or INCOMING or both
		-->
		<g:each in="${planningList.planningEntryBudgetList}" var="budgetPlanningEntry">
			<tr class="tree-sign js_foldable budget-entry">
				<td>
					<span class="js_foldable-toggle" style="margin-left: 20px;"> <a href="#">&zwnj;</a> </span>
					<span>
						<a class="js_budget-section-link" href="${createLink(controller:'editPlanning', action:'editPlanningEntry', params:[location:location.id, planningType:planningList.planningType.id, lineNumber: budgetPlanningEntry.lineNumber])}">
							<g:if test="${planningType.fixedHeader != null && !planningType.fixedHeader.empty}">
								<g:value value="${budgetPlanningEntry.fixedHeaderValue}" type="${budgetPlanningEntry.type.fixedHeaderType}" nullText="none entered"/>
							</g:if>
							<g:else>
								<g:i18n field="${planningType.names}"/> ${budgetPlanningEntry.lineNumber + 1}
							</g:else>
						</a>
					</span>
				</td>
				<td><g:formatNumber number="${budgetPlanningEntry.getIncoming(planningType.costs)}" format="#,###"/></td>
				<td><g:formatNumber number="${budgetPlanningEntry.getOutgoing(planningType.costs)}" format="#,###"/></td>
				<td><g:formatNumber number="${budgetPlanningEntry.getDifference(planningType.costs)}" format="#,###"/></td>
				<td class="status ${!budgetPlanningEntry.invalidSections.empty?'invalid':!budgetPlanningEntry.incompleteSections.empty?'incomplete':'complete'}" title=""></td>
			</tr>
			<tr class="sub-tree js_foldable-container hidden">
				<td colspan="7" class="bucket">
					<g:render template="/planning/budget/costs" model="[budgetPlanningEntry: budgetPlanningEntry, planningType: planningList.planningType, margin: 40, currentGroups: []]"/>
				</td>
			</tr>
		</g:each>
	</tbody>
</table>


<table class="nested budget push-top-10">
	<thead>
		<tr>
			<th></th>
			<th><g:message code="planning.budget.table.incoming"/></th>
			<th><g:message code="planning.budget.table.outgoing"/></th>
			<th><g:message code="planning.budget.table.difference"/></th>
			<th class="status"></th>
		</tr>
	</thead>
	<tbody>
		<!-- 
			Each PLANNING TYPE, this should not be displayed
		    if there is no entries in the corresponding planning type 
		-->
		<g:each in="${planningLists}" var="planningList">
			<g:if test="${!planningList.planningEntryBudgetList.empty}">
				<g:set var="planningType" value="${planningList.planningType}"/>
				<tr class="tree-sign js_foldable standout">
					<td class="js_foldable-toggle">
						<span>
							<g:i18n field="${planningList.planningType.namesPlural}"/>
						</span>
					</td>
					<td><g:formatNumber number="${planningList.incoming}" format="#,###"/></td>
					<td><g:formatNumber number="${planningList.outgoing}" format="#,###"/></td>
					<td><g:formatNumber number="${planningList.difference}" format="#,###"/></td>
					<td class="status"></td>
				</tr>
				<tr class="sub-tree js_foldable-container hidden">
					<g:if test="${planningType.maxNumber != 1}">
						<td colspan="7" class="bucket">
					    	<g:table lines="${planningList.budgetTable}" columns="[1,2,3]"/>
						</td>
					</g:if>
					<g:else>
						<g:each in="${planningList.planningEntryBudgetList}" var="budgetPlanningEntry">
							<td colspan="7" class="bucket">
								<g:render template="/planning/budget/costs" model="[budgetPlanningEntry: budgetPlanningEntry, planningType: planningList.planningType, margin: 20, currentGroups: []]"/>
							</td>
						</g:each>
					</g:else>
				</tr>
			</g:if>
		</g:each>
		<tr class="total">
			<td><g:message code="planning.budget.table.total"/>:</td>
			<td><g:formatNumber number="${incoming}" format="#,###"/></td>
			<td><g:formatNumber number="${outgoing}" format="#,###"/></td>
			<td class="${difference < 0?'red':''}"><g:formatNumber number="${difference}" format="#,###"/></td>
			<td class="status"></td>
		</tr>
	</tbody>
</table>


<table class="nested budget push-top-10">
	<thead>
		<tr>
			<th></th>
			<th><g:message code="planning.budget.table.incoming"/></th>
			<th><g:message code="planning.budget.table.outgoing"/></th>
			<th><g:message code="planning.budget.table.difference"/></th>
			<th class="status"></th>
		</tr>
	</thead>
	<tbody>
		<!-- 
			Each PLANNING TYPE, this should not be displayed
		    if there is no entries in the corresponding planning type 
		-->
		<g:each in="${planningLists}" var="planningList">
			<g:if test="${!planningList.planningEntryBudgetList.empty}">
				<g:tableLines lines="${[planningList.aggregateLine]}" columns="3"/>
			</g:if>
		</g:each>
		<tr class="total">
			<td><g:message code="planning.budget.table.total"/>:</td>
			<td><g:formatNumber number="${incoming}" format="#,###"/></td>
			<td><g:formatNumber number="${outgoing}" format="#,###"/></td>
			<td class="${difference < 0?'red':''}"><g:formatNumber number="${difference}" format="#,###"/></td>
			<td class="status"></td>
		</tr>
		<tr class="total">
			<td><g:message code="planning.budget.table.total"/>:</td>
			<td><g:formatNumber number="${incoming}" format="#,###"/></td>
			<td><g:formatNumber number="${outgoing}" format="#,###"/></td>
			<td class="${difference < 0?'red':''}"><g:formatNumber number="${difference}" format="#,###"/></td>
			<td class="status"></td>
		</tr>
	</tbody>
</table>